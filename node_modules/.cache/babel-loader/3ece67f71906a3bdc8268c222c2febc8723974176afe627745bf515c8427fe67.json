{"ast":null,"code":"import { a as createRecordOfflinePlayer } from './record-27e852e2.js';\nimport './common-ba25e019.js';\nimport './sdk-082d96e7.js';\n\n// сначала создаем mock, затем вызываем createAssistant\nvar createAssistantHostMock = function createAssistantHostMock(_a) {\n  var _b = _a === void 0 ? {} : _a,\n    _c = _b.context,\n    context = _c === void 0 ? window : _c;\n  /* eslint-disable-next-line no-spaced-func, func-call-spacing, @typescript-eslint/no-explicit-any */\n  var handlers = new Map();\n  var currentResolve = null;\n  var _onReady;\n  var handleAction = function handleAction(action, name, requestId) {\n    if (!context.AssistantClient || !context.AssistantClient.onRequestState || !context.AssistantClient.onData) {\n      throw new Error('Assistant not initialized');\n    }\n    if (currentResolve) {\n      var resolve = currentResolve;\n      currentResolve = null;\n      resolve({\n        state: context.AssistantClient.onRequestState(),\n        name: name,\n        action: action,\n        requestId: requestId\n      });\n      return;\n    }\n    if ('action_id' in action) {\n      var actionType = action.action_id.toLowerCase();\n      var handler = handlers.has(actionType) ? handlers.get(actionType) : undefined;\n      if (handler != null) {\n        handler(action);\n      }\n    }\n  };\n  context.AssistantHost = {\n    close: function close() {\n      // ничего не делаем\n    },\n    ready: function ready() {\n      var _a, _b;\n      ((_a = window.AssistantClient) === null || _a === void 0 ? void 0 : _a.onStart) && ((_b = window.AssistantClient) === null || _b === void 0 ? void 0 : _b.onStart());\n      _onReady && _onReady();\n    },\n    sendData: function sendData(action, message) {\n      handleAction(JSON.parse(action), message);\n    },\n    sendDataContainer: function sendDataContainer(container) {\n      var _a = JSON.parse(container),\n        action = _a.data,\n        name = _a.message_name,\n        requestId = _a.requestId;\n      handleAction(action, name, requestId);\n    },\n    setSuggests: function setSuggests() {\n      throw new Error('Not implemented method');\n    },\n    setHints: function setHints() {\n      throw new Error('Not implemented method');\n    },\n    sendText: function sendText() {\n      throw new Error('Not implemented method');\n    },\n    setHeaderButtons: function setHeaderButtons() {\n      throw new Error('Not implemented method');\n    }\n  };\n  /** Добавить обработчик клиентского экшена */\n  var addActionHandler = function addActionHandler(actionType, handler) {\n    var type = actionType.toLowerCase();\n    if (handlers.has(type)) {\n      throw new Error('Action-handler already exists');\n    }\n    handlers.set(type, handler);\n  };\n  /** Удалить обработчик клиентского экшена */\n  var removeActionHandler = function removeActionHandler(actionType) {\n    var type = actionType.toLowerCase();\n    if (handlers.has(type)) {\n      handlers.delete(type);\n    }\n  };\n  /** Вызвать обработчик команды бека */\n  var receiveCommand = function receiveCommand(command) {\n    if (!context.AssistantClient || !context.AssistantClient.onData) {\n      throw new Error('Assistant not initialized');\n    }\n    context.AssistantClient.onData(command);\n    return new Promise(function (resolve) {\n      return setTimeout(resolve);\n    });\n  };\n  /** Дождаться и вернуть клиентский экшен и его контекст */\n  var waitAction = function waitAction(onAction) {\n    return new Promise(function (resolve) {\n      currentResolve = resolve;\n      onAction && onAction();\n    });\n  };\n  return {\n    addActionHandler: addActionHandler,\n    removeActionHandler: removeActionHandler,\n    receiveCommand: receiveCommand,\n    waitAction: waitAction,\n    onReady: function onReady(cb) {\n      _onReady = cb;\n    }\n  };\n};\nvar createAssistantHostMockWithRecord = function createAssistantHostMockWithRecord(_a) {\n  var _b = _a.context,\n    context = _b === void 0 ? window : _b,\n    record = _a.record;\n  var mock = createAssistantHostMock({\n    context: context\n  });\n  var player = createRecordOfflinePlayer(record, {\n    context: context\n  });\n  var hasNext = true;\n  var next = function next(_a) {\n    var _b = _a === void 0 ? {} : _a,\n      onRequest = _b.onRequest,\n      _c = _b.waitRequest,\n      waitRequest = _c === void 0 ? false : _c;\n    return new Promise(function (resolve) {\n      hasNext = player.continue(function (command) {\n        if (!waitRequest && onRequest == null) {\n          resolve(mock.receiveCommand(command));\n          return;\n        }\n        return mock.waitAction(onRequest).then(function (result) {\n          // на будущее - неплохо было бы иметь эталон из записи\n          mock.receiveCommand(command);\n          resolve(result);\n        });\n      });\n    });\n  };\n  return {\n    get hasNext() {\n      return hasNext;\n    },\n    onReady: mock.onReady,\n    next: next,\n    receiveCommand: mock.receiveCommand\n  };\n};\nexport { createAssistantHostMock, createAssistantHostMockWithRecord };","map":{"version":3,"names":["a","createRecordOfflinePlayer","createAssistantHostMock","_a","_b","_c","context","window","handlers","Map","currentResolve","onReady","handleAction","action","name","requestId","AssistantClient","onRequestState","onData","Error","resolve","state","actionType","action_id","toLowerCase","handler","has","get","undefined","AssistantHost","close","ready","onStart","sendData","message","JSON","parse","sendDataContainer","container","data","message_name","setSuggests","setHints","sendText","setHeaderButtons","addActionHandler","type","set","removeActionHandler","delete","receiveCommand","command","Promise","setTimeout","waitAction","onAction","cb","createAssistantHostMockWithRecord","record","mock","player","hasNext","next","onRequest","waitRequest","continue","then","result"],"sources":["/Users/egor/Documents/GitHub/SBERProject/node_modules/@salutejs/client/esm/mock.js"],"sourcesContent":["import { a as createRecordOfflinePlayer } from './record-27e852e2.js';\nimport './common-ba25e019.js';\nimport './sdk-082d96e7.js';\n\n// сначала создаем mock, затем вызываем createAssistant\nvar createAssistantHostMock = function (_a) {\n    var _b = _a === void 0 ? {} : _a, _c = _b.context, context = _c === void 0 ? window : _c;\n    /* eslint-disable-next-line no-spaced-func, func-call-spacing, @typescript-eslint/no-explicit-any */\n    var handlers = new Map();\n    var currentResolve = null;\n    var onReady;\n    var handleAction = function (action, name, requestId) {\n        if (!context.AssistantClient || !context.AssistantClient.onRequestState || !context.AssistantClient.onData) {\n            throw new Error('Assistant not initialized');\n        }\n        if (currentResolve) {\n            var resolve = currentResolve;\n            currentResolve = null;\n            resolve({\n                state: context.AssistantClient.onRequestState(),\n                name: name,\n                action: action,\n                requestId: requestId,\n            });\n            return;\n        }\n        if ('action_id' in action) {\n            var actionType = action.action_id.toLowerCase();\n            var handler = handlers.has(actionType) ? handlers.get(actionType) : undefined;\n            if (handler != null) {\n                handler(action);\n            }\n        }\n    };\n    context.AssistantHost = {\n        close: function () {\n            // ничего не делаем\n        },\n        ready: function () {\n            var _a, _b;\n            ((_a = window.AssistantClient) === null || _a === void 0 ? void 0 : _a.onStart) && ((_b = window.AssistantClient) === null || _b === void 0 ? void 0 : _b.onStart());\n            onReady && onReady();\n        },\n        sendData: function (action, message) {\n            handleAction(JSON.parse(action), message);\n        },\n        sendDataContainer: function (container) {\n            var _a = JSON.parse(container), action = _a.data, name = _a.message_name, requestId = _a.requestId;\n            handleAction(action, name, requestId);\n        },\n        setSuggests: function () {\n            throw new Error('Not implemented method');\n        },\n        setHints: function () {\n            throw new Error('Not implemented method');\n        },\n        sendText: function () {\n            throw new Error('Not implemented method');\n        },\n        setHeaderButtons: function () {\n            throw new Error('Not implemented method');\n        },\n    };\n    /** Добавить обработчик клиентского экшена */\n    var addActionHandler = function (actionType, handler) {\n        var type = actionType.toLowerCase();\n        if (handlers.has(type)) {\n            throw new Error('Action-handler already exists');\n        }\n        handlers.set(type, handler);\n    };\n    /** Удалить обработчик клиентского экшена */\n    var removeActionHandler = function (actionType) {\n        var type = actionType.toLowerCase();\n        if (handlers.has(type)) {\n            handlers.delete(type);\n        }\n    };\n    /** Вызвать обработчик команды бека */\n    var receiveCommand = function (command) {\n        if (!context.AssistantClient || !context.AssistantClient.onData) {\n            throw new Error('Assistant not initialized');\n        }\n        context.AssistantClient.onData(command);\n        return new Promise(function (resolve) { return setTimeout(resolve); });\n    };\n    /** Дождаться и вернуть клиентский экшен и его контекст */\n    var waitAction = function (onAction) {\n        return new Promise(function (resolve) {\n            currentResolve = resolve;\n            onAction && onAction();\n        });\n    };\n    return {\n        addActionHandler: addActionHandler,\n        removeActionHandler: removeActionHandler,\n        receiveCommand: receiveCommand,\n        waitAction: waitAction,\n        onReady: function (cb) {\n            onReady = cb;\n        },\n    };\n};\nvar createAssistantHostMockWithRecord = function (_a) {\n    var _b = _a.context, context = _b === void 0 ? window : _b, record = _a.record;\n    var mock = createAssistantHostMock({ context: context });\n    var player = createRecordOfflinePlayer(record, { context: context });\n    var hasNext = true;\n    var next = function (_a) {\n        var _b = _a === void 0 ? {} : _a, onRequest = _b.onRequest, _c = _b.waitRequest, waitRequest = _c === void 0 ? false : _c;\n        return new Promise(function (resolve) {\n            hasNext = player.continue(function (command) {\n                if (!waitRequest && onRequest == null) {\n                    resolve(mock.receiveCommand(command));\n                    return;\n                }\n                return mock.waitAction(onRequest).then(function (result) {\n                    // на будущее - неплохо было бы иметь эталон из записи\n                    mock.receiveCommand(command);\n                    resolve(result);\n                });\n            });\n        });\n    };\n    return {\n        get hasNext() {\n            return hasNext;\n        },\n        onReady: mock.onReady,\n        next: next,\n        receiveCommand: mock.receiveCommand,\n    };\n};\n\nexport { createAssistantHostMock, createAssistantHostMockWithRecord };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}